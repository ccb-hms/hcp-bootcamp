<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>HCP Intro to R Bootcamp - Data wrangling I</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script src="../site_libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="../site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="../site_libs/datatables-binding-0.30/datatables.js"></script>
<script src="../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../site_libs/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="../site_libs/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="../site_libs/dt-core-1.13.4/js/jquery.dataTables.min.js"></script>
<link href="../site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="../site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">HCP Intro to R Bootcamp</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../notebooks/sessions.html" rel="" target="" aria-current="page">
 <span class="menu-text">Session Materials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../resources/resources.html" rel="" target="">
 <span class="menu-text">Resources</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../notebooks/session4.html">Data wrangling I</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/sessions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sessions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/session1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R Basics and Reproducibility Tools</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/session2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summarizing and Visualizing data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/session3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modeling and Testing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/session4.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Data wrangling I</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/session5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Wrangling II and Other Analysis Skills</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#synthetic-cms-data" id="toc-synthetic-cms-data" class="nav-link active" data-scroll-target="#synthetic-cms-data">Synthetic CMS Data</a>
  <ul class="collapse">
  <li><a href="#load-beneficiaries-summary-file" id="toc-load-beneficiaries-summary-file" class="nav-link" data-scroll-target="#load-beneficiaries-summary-file">Load Beneficiaries summary file</a></li>
  <li><a href="#load-inpatient-table" id="toc-load-inpatient-table" class="nav-link" data-scroll-target="#load-inpatient-table">Load inpatient table</a></li>
  </ul></li>
  <li><a href="#combining-data" id="toc-combining-data" class="nav-link" data-scroll-target="#combining-data">Combining Data</a>
  <ul class="collapse">
  <li><a href="#adding-more-rows" id="toc-adding-more-rows" class="nav-link" data-scroll-target="#adding-more-rows">Adding more rows</a></li>
  <li><a href="#merging-datasets-by-matching-values" id="toc-merging-datasets-by-matching-values" class="nav-link" data-scroll-target="#merging-datasets-by-matching-values">Merging datasets by matching values</a>
  <ul class="collapse">
  <li><a href="#joining" id="toc-joining" class="nav-link" data-scroll-target="#joining">Joining</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#creating-new-columns" id="toc-creating-new-columns" class="nav-link" data-scroll-target="#creating-new-columns">Creating new columns</a>
  <ul class="collapse">
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#mutate" id="toc-mutate" class="nav-link" data-scroll-target="#mutate">Mutate</a></li>
  <li><a href="#split-apply-combine-data-analysis" id="toc-split-apply-combine-data-analysis" class="nav-link" data-scroll-target="#split-apply-combine-data-analysis">Split-apply-combine data analysis</a>
  <ul class="collapse">
  <li><a href="#the-summarise-function" id="toc-the-summarise-function" class="nav-link" data-scroll-target="#the-summarise-function">The <code>summarise()</code> function</a></li>
  <li><a href="#counting" id="toc-counting" class="nav-link" data-scroll-target="#counting">Counting</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#data-cleaning-pipeline" id="toc-data-cleaning-pipeline" class="nav-link" data-scroll-target="#data-cleaning-pipeline">Data cleaning pipeline</a>
  <ul class="collapse">
  <li><a href="#numeric-variables" id="toc-numeric-variables" class="nav-link" data-scroll-target="#numeric-variables">Numeric variables</a></li>
  <li><a href="#categorical-variables" id="toc-categorical-variables" class="nav-link" data-scroll-target="#categorical-variables">Categorical variables</a></li>
  <li><a href="#new-variables" id="toc-new-variables" class="nav-link" data-scroll-target="#new-variables">New variables</a>
  <ul class="collapse">
  <li><a href="#making-ages-with-cut" id="toc-making-ages-with-cut" class="nav-link" data-scroll-target="#making-ages-with-cut">Making ages with cut</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#string-manipulation" id="toc-string-manipulation" class="nav-link" data-scroll-target="#string-manipulation">String Manipulation</a>
  <ul class="collapse">
  <li><a href="#combining-and-joining-strings" id="toc-combining-and-joining-strings" class="nav-link" data-scroll-target="#combining-and-joining-strings">Combining and joining strings</a></li>
  <li><a href="#combining-and-joining-columns" id="toc-combining-and-joining-columns" class="nav-link" data-scroll-target="#combining-and-joining-columns">Combining and joining columns</a></li>
  <li><a href="#standardizing-strings" id="toc-standardizing-strings" class="nav-link" data-scroll-target="#standardizing-strings">Standardizing Strings</a></li>
  <li><a href="#patterns" id="toc-patterns" class="nav-link" data-scroll-target="#patterns">Patterns</a></li>
  </ul></li>
  <li><a href="#column-cleaning" id="toc-column-cleaning" class="nav-link" data-scroll-target="#column-cleaning">Column cleaning</a>
  <ul class="collapse">
  <li><a href="#data-1" id="toc-data-1" class="nav-link" data-scroll-target="#data-1">Data</a></li>
  <li><a href="#cleaning-column-names" id="toc-cleaning-column-names" class="nav-link" data-scroll-target="#cleaning-column-names">Cleaning column names</a>
  <ul class="collapse">
  <li><a href="#automatic-cleaning" id="toc-automatic-cleaning" class="nav-link" data-scroll-target="#automatic-cleaning">Automatic cleaning</a></li>
  <li><a href="#manual-cleaning" id="toc-manual-cleaning" class="nav-link" data-scroll-target="#manual-cleaning">Manual Cleaning</a></li>
  </ul></li>
  <li><a href="#advanced-column-selection" id="toc-advanced-column-selection" class="nav-link" data-scroll-target="#advanced-column-selection">Advanced Column Selection</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data wrangling I</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="synthetic-cms-data" class="level1">
<h1>Synthetic CMS Data</h1>
<section id="load-beneficiaries-summary-file" class="level2">
<h2 data-anchor-id="load-beneficiaries-summary-file">Load Beneficiaries summary file</h2>
<p>Let’s load the data and the column labels.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.3     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.4     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.0
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>ben_summary_2008 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../data/de_synpuf/DE1_0_2008_Beneficiary_Summary_File_Sample_1.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 116352 Columns: 32
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (5): DESYNPUF_ID, BENE_ESRD_IND, SP_STATE_CODE, BENE_COUNTY_CD, PLAN_CV...
dbl (27): BENE_BIRTH_DT, BENE_DEATH_DT, BENE_SEX_IDENT_CD, BENE_RACE_CD, BEN...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>ben_summary_2009 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../data/de_synpuf/DE1_0_2009_Beneficiary_Summary_File_Sample_1.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 114538 Columns: 32
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (5): DESYNPUF_ID, BENE_ESRD_IND, SP_STATE_CODE, BENE_COUNTY_CD, PLAN_CV...
dbl (27): BENE_BIRTH_DT, BENE_DEATH_DT, BENE_SEX_IDENT_CD, BENE_RACE_CD, BEN...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>ben_summary_labels <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../data/de_synpuf/ben_metadata.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 32 Columns: 2
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (2): Name, Label

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ben_summary_2008)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> DESYNPUF_ID        BENE_BIRTH_DT      BENE_DEATH_DT      BENE_SEX_IDENT_CD
 Length:116352      Min.   :19090101   Min.   :20080101   Min.   :1.000    
 Class :character   1st Qu.:19281101   1st Qu.:20080301   1st Qu.:1.000    
 Mode  :character   Median :19360501   Median :20080701   Median :2.000    
                    Mean   :19364181   Mean   :20080654   Mean   :1.553    
                    3rd Qu.:19420301   3rd Qu.:20081001   3rd Qu.:2.000    
                    Max.   :19831201   Max.   :20081201   Max.   :2.000    
                                       NA's   :114538                      
  BENE_RACE_CD   BENE_ESRD_IND      SP_STATE_CODE      BENE_COUNTY_CD    
 Min.   :1.000   Length:116352      Length:116352      Length:116352     
 1st Qu.:1.000   Class :character   Class :character   Class :character  
 Median :1.000   Mode  :character   Mode  :character   Mode  :character  
 Mean   :1.285                                                           
 3rd Qu.:1.000                                                           
 Max.   :5.000                                                           
                                                                         
 BENE_HI_CVRAGE_TOT_MONS BENE_SMI_CVRAGE_TOT_MONS BENE_HMO_CVRAGE_TOT_MONS
 Min.   : 0.00           Min.   : 0.0             Min.   : 0.000          
 1st Qu.:12.00           1st Qu.:12.0             1st Qu.: 0.000          
 Median :12.00           Median :12.0             Median : 0.000          
 Mean   :11.14           Mean   :10.5             Mean   : 2.576          
 3rd Qu.:12.00           3rd Qu.:12.0             3rd Qu.: 0.000          
 Max.   :12.00           Max.   :12.0             Max.   :12.000          
                                                                          
 PLAN_CVRG_MOS_NUM   SP_ALZHDMTA        SP_CHF       SP_CHRNKIDN   
 Length:116352      Min.   :1.000   Min.   :1.000   Min.   :1.000  
 Class :character   1st Qu.:2.000   1st Qu.:1.000   1st Qu.:2.000  
 Mode  :character   Median :2.000   Median :2.000   Median :2.000  
                    Mean   :1.807   Mean   :1.715   Mean   :1.839  
                    3rd Qu.:2.000   3rd Qu.:2.000   3rd Qu.:2.000  
                    Max.   :2.000   Max.   :2.000   Max.   :2.000  
                                                                   
    SP_CNCR         SP_COPD       SP_DEPRESSN     SP_DIABETES   
 Min.   :1.000   Min.   :1.000   Min.   :1.000   Min.   :1.000  
 1st Qu.:2.000   1st Qu.:2.000   1st Qu.:2.000   1st Qu.:1.000  
 Median :2.000   Median :2.000   Median :2.000   Median :2.000  
 Mean   :1.936   Mean   :1.865   Mean   :1.787   Mean   :1.621  
 3rd Qu.:2.000   3rd Qu.:2.000   3rd Qu.:2.000   3rd Qu.:2.000  
 Max.   :2.000   Max.   :2.000   Max.   :2.000   Max.   :2.000  
                                                                
  SP_ISCHMCHT     SP_OSTEOPRS       SP_RA_OA      SP_STRKETIA   
 Min.   :1.000   Min.   :1.000   Min.   :1.000   Min.   :1.000  
 1st Qu.:1.000   1st Qu.:2.000   1st Qu.:2.000   1st Qu.:2.000  
 Median :2.000   Median :2.000   Median :2.000   Median :2.000  
 Mean   :1.579   Mean   :1.827   Mean   :1.846   Mean   :1.955  
 3rd Qu.:2.000   3rd Qu.:2.000   3rd Qu.:2.000   3rd Qu.:2.000  
 Max.   :2.000   Max.   :2.000   Max.   :2.000   Max.   :2.000  
                                                                
  MEDREIMB_IP       BENRES_IP         PPPYMT_IP         MEDREIMB_OP     
 Min.   : -3000   Min.   :    0.0   Min.   :    0.00   Min.   :  -90.0  
 1st Qu.:     0   1st Qu.:    0.0   1st Qu.:    0.00   1st Qu.:    0.0  
 Median :     0   Median :    0.0   Median :    0.00   Median :   20.0  
 Mean   :  2214   Mean   :  249.1   Mean   :   99.14   Mean   :  622.2  
 3rd Qu.:     0   3rd Qu.:    0.0   3rd Qu.:    0.00   3rd Qu.:  550.0  
 Max.   :164220   Max.   :53096.0   Max.   :68000.00   Max.   :50020.0  
                                                                        
   BENRES_OP         PPPYMT_OP         MEDREIMB_CAR     BENRES_CAR    
 Min.   :    0.0   Min.   :    0.00   Min.   :    0   Min.   :   0.0  
 1st Qu.:    0.0   1st Qu.:    0.00   1st Qu.:    0   1st Qu.:   0.0  
 Median :    0.0   Median :    0.00   Median :  610   Median : 170.0  
 Mean   :  197.5   Mean   :   25.72   Mean   : 1162   Mean   : 328.7  
 3rd Qu.:  180.0   3rd Qu.:    0.00   3rd Qu.: 1650   3rd Qu.: 480.0  
 Max.   :12450.0   Max.   :14400.00   Max.   :21160   Max.   :5260.0  
                                                                      
   PPPYMT_CAR     
 Min.   :   0.00  
 1st Qu.:   0.00  
 Median :   0.00  
 Mean   :  18.36  
 3rd Qu.:   0.00  
 Max.   :2110.00  
                  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(ben_summary_labels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-a8fc2d7aee3f7b5df3eb" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-a8fc2d7aee3f7b5df3eb">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32"],["DESYNPUF_ID","BENE_BIRTH_DT","BENE_DEATH_DT","BENE_SEX_IDENT_CD","BENE_RACE_CD","BENE_ESRD_IND","SP_STATE_CODE","BENE_COUNTY_CD","BENE_HI_CVRAGE_TOT_MONS","BENE_SMI_CVRAGE_TOT_MONS","BENE_HMO_CVRAGE_TOT_MONS","PLAN_CVRG_MOS_NUM","SP_ALZHDMTA","SP_CHF","SP_CHRNKIDN","SP_CNCR","SP_COPD","SP_DEPRESSN","SP_DIABETES","SP_ISCHMCHT","SP_OSTEOPRS","SP_RA_OA","SP_STRKETIA","MEDREIMB_IP","BENRES_IP","PPPYMT_IP","MEDREIMB_OP","BENRES_OP","PPPYMT_OP","MEDREIMB_CAR","BENRES_CAR","PPPYMT_CAR"],["Beneficiary Code","Date of birth","Date of death","Sex","Beneficiary Race Code","End stage renal disease Indicator","State Code","County Code","Total number of months of part A coverage for the beneficiary.","Total number of months of part B coverage for the beneficiary.","Total number of months of HMO coverage for the beneficiary.","Total number of months of part D plan coverage for the beneficiary.","Chronic Condition: Alzheimer or related disorders or senile","Chronic Condition: Heart Failure","Chronic Condition: Chronic Kidney Disease","Chronic Condition: Cancer","Chronic Condition: Chronic Obstructive Pulmonary Disease","Chronic Condition: Depression","Chronic Condition: Diabetes","Chronic Condition: Ischemic Heart Disease","Chronic Condition: Osteoporosis","Chronic Condition: RA/OA","Chronic Condition: Stroke/transient Ischemic Attack","Inpatient annual Medicare reimbursement amount","Inpatient annual beneficiary responsibility amount","Inpatient annual primary payer reimbursement amount","Outpatient Institutional annual Medicare reimbursement amount","Outpatient Institutional annual beneficiary responsibility amount","Outpatient Institutional annual primary payer reimbursement amount","Carrier annual Medicare reimbursement amount","Carrier annual beneficiary responsibility amount","Carrier annual primary payer reimbursement amount"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Name<\/th>\n      <th>Label<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="load-inpatient-table" class="level2">
<h2 data-anchor-id="load-inpatient-table">Load inpatient table</h2>
<p>Now let’s load and link in the inpatient data. To make things simpler, we will drop everything except for the 2008 data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>inp_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../data/de_synpuf/DE1_0_2008_to_2010_Inpatient_Claims_Sample_1.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 66773 Columns: 81
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (23): DESYNPUF_ID, PRVDR_NUM, AT_PHYSN_NPI, OP_PHYSN_NPI, OT_PHYSN_NPI, ...
dbl (13): CLM_ID, SEGMENT, CLM_FROM_DT, CLM_THRU_DT, CLM_PMT_AMT, NCH_PRMRY_...
lgl (45): HCPCS_CD_1, HCPCS_CD_2, HCPCS_CD_3, HCPCS_CD_4, HCPCS_CD_5, HCPCS_...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>inp_labels <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../data/de_synpuf/inp_metadata.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 23 Columns: 2
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (2): Name, Label

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(inp_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> DESYNPUF_ID            CLM_ID             SEGMENT       CLM_FROM_DT      
 Length:66773       Min.   :1.960e+14   Min.   :1.000   Min.   :20071127  
 Class :character   1st Qu.:1.963e+14   1st Qu.:1.000   1st Qu.:20080812  
 Mode  :character   Median :1.965e+14   Median :1.000   Median :20090316  
                    Mean   :1.965e+14   Mean   :1.001   Mean   :20088463  
                    3rd Qu.:1.968e+14   3rd Qu.:1.000   3rd Qu.:20091112  
                    Max.   :1.970e+14   Max.   :2.000   Max.   :20101230  
                                                        NA's   :68        
  CLM_THRU_DT        PRVDR_NUM          CLM_PMT_AMT    NCH_PRMRY_PYR_CLM_PD_AMT
 Min.   :20080101   Length:66773       Min.   :-8000   Min.   :    0.0         
 1st Qu.:20080818   Class :character   1st Qu.: 4000   1st Qu.:    0.0         
 Median :20090321   Mode  :character   Median : 7000   Median :    0.0         
 Mean   :20088611                      Mean   : 9574   Mean   :  398.9         
 3rd Qu.:20091117                      3rd Qu.:11000   3rd Qu.:    0.0         
 Max.   :20101231                      Max.   :57000   Max.   :68000.0         
 NA's   :68                                                                    
 AT_PHYSN_NPI       OP_PHYSN_NPI       OT_PHYSN_NPI        CLM_ADMSN_DT     
 Length:66773       Length:66773       Length:66773       Min.   :20071127  
 Class :character   Class :character   Class :character   1st Qu.:20080812  
 Mode  :character   Mode  :character   Mode  :character   Median :20090316  
                                                          Mean   :20088463  
                                                          3rd Qu.:20091112  
                                                          Max.   :20101230  
                                                                            
 ADMTNG_ICD9_DGNS_CD CLM_PASS_THRU_PER_DIEM_AMT NCH_BENE_IP_DDCTBL_AMT
 Length:66773        Min.   :  0.00             Min.   :1024          
 Class :character    1st Qu.:  0.00             1st Qu.:1024          
 Mode  :character    Median :  0.00             Median :1068          
                     Mean   : 28.98             Mean   :1057          
                     3rd Qu.: 10.00             3rd Qu.:1068          
                     Max.   :500.00             Max.   :1100          
                                                NA's   :2178          
 NCH_BENE_PTA_COINSRNC_LBLTY_AM NCH_BENE_BLOOD_DDCTBL_LBLTY_AM
 Min.   :    0.00               Min.   :   0.00               
 1st Qu.:    0.00               1st Qu.:   0.00               
 Median :    0.00               Median :   0.00               
 Mean   :   90.03               Mean   :   1.59               
 3rd Qu.:    0.00               3rd Qu.:   0.00               
 Max.   :34000.00               Max.   :2000.00               
                                                              
 CLM_UTLZTN_DAY_CNT NCH_BENE_DSCHRG_DT  CLM_DRG_CD        ICD9_DGNS_CD_1    
 Min.   :  0.000    Min.   :20080101   Length:66773       Length:66773      
 1st Qu.:  2.000    1st Qu.:20080818   Class :character   Class :character  
 Median :  4.000    Median :20090321   Mode  :character   Mode  :character  
 Mean   :  5.583    Mean   :20088612                                        
 3rd Qu.:  7.000    3rd Qu.:20091117                                        
 Max.   :136.000    Max.   :20101231                                        
 NA's   :68                                                                 
 ICD9_DGNS_CD_2     ICD9_DGNS_CD_3     ICD9_DGNS_CD_4     ICD9_DGNS_CD_5    
 Length:66773       Length:66773       Length:66773       Length:66773      
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
                                                                            
 ICD9_DGNS_CD_6     ICD9_DGNS_CD_7     ICD9_DGNS_CD_8     ICD9_DGNS_CD_9    
 Length:66773       Length:66773       Length:66773       Length:66773      
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
                                                                            
 ICD9_DGNS_CD_10    ICD9_PRCDR_CD_1    ICD9_PRCDR_CD_2    ICD9_PRCDR_CD_3   
 Length:66773       Length:66773       Length:66773       Length:66773      
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
                                                                            
 ICD9_PRCDR_CD_4    ICD9_PRCDR_CD_5    ICD9_PRCDR_CD_6    HCPCS_CD_1    
 Length:66773       Length:66773       Length:66773       Mode:logical  
 Class :character   Class :character   Class :character   NA's:66773    
 Mode  :character   Mode  :character   Mode  :character                 
                                                                        
                                                                        
                                                                        
                                                                        
 HCPCS_CD_2     HCPCS_CD_3     HCPCS_CD_4     HCPCS_CD_5     HCPCS_CD_6    
 Mode:logical   Mode:logical   Mode:logical   Mode:logical   Mode:logical  
 NA's:66773     NA's:66773     NA's:66773     NA's:66773     NA's:66773    
                                                                           
                                                                           
                                                                           
                                                                           
                                                                           
 HCPCS_CD_7     HCPCS_CD_8     HCPCS_CD_9     HCPCS_CD_10    HCPCS_CD_11   
 Mode:logical   Mode:logical   Mode:logical   Mode:logical   Mode:logical  
 NA's:66773     NA's:66773     NA's:66773     NA's:66773     NA's:66773    
                                                                           
                                                                           
                                                                           
                                                                           
                                                                           
 HCPCS_CD_12    HCPCS_CD_13    HCPCS_CD_14    HCPCS_CD_15    HCPCS_CD_16   
 Mode:logical   Mode:logical   Mode:logical   Mode:logical   Mode:logical  
 NA's:66773     NA's:66773     NA's:66773     NA's:66773     NA's:66773    
                                                                           
                                                                           
                                                                           
                                                                           
                                                                           
 HCPCS_CD_17    HCPCS_CD_18    HCPCS_CD_19    HCPCS_CD_20    HCPCS_CD_21   
 Mode:logical   Mode:logical   Mode:logical   Mode:logical   Mode:logical  
 NA's:66773     NA's:66773     NA's:66773     NA's:66773     NA's:66773    
                                                                           
                                                                           
                                                                           
                                                                           
                                                                           
 HCPCS_CD_22    HCPCS_CD_23    HCPCS_CD_24    HCPCS_CD_25    HCPCS_CD_26   
 Mode:logical   Mode:logical   Mode:logical   Mode:logical   Mode:logical  
 NA's:66773     NA's:66773     NA's:66773     NA's:66773     NA's:66773    
                                                                           
                                                                           
                                                                           
                                                                           
                                                                           
 HCPCS_CD_27    HCPCS_CD_28    HCPCS_CD_29    HCPCS_CD_30    HCPCS_CD_31   
 Mode:logical   Mode:logical   Mode:logical   Mode:logical   Mode:logical  
 NA's:66773     NA's:66773     NA's:66773     NA's:66773     NA's:66773    
                                                                           
                                                                           
                                                                           
                                                                           
                                                                           
 HCPCS_CD_32    HCPCS_CD_33    HCPCS_CD_34    HCPCS_CD_35    HCPCS_CD_36   
 Mode:logical   Mode:logical   Mode:logical   Mode:logical   Mode:logical  
 NA's:66773     NA's:66773     NA's:66773     NA's:66773     NA's:66773    
                                                                           
                                                                           
                                                                           
                                                                           
                                                                           
 HCPCS_CD_37    HCPCS_CD_38    HCPCS_CD_39    HCPCS_CD_40    HCPCS_CD_41   
 Mode:logical   Mode:logical   Mode:logical   Mode:logical   Mode:logical  
 NA's:66773     NA's:66773     NA's:66773     NA's:66773     NA's:66773    
                                                                           
                                                                           
                                                                           
                                                                           
                                                                           
 HCPCS_CD_42    HCPCS_CD_43    HCPCS_CD_44    HCPCS_CD_45   
 Mode:logical   Mode:logical   Mode:logical   Mode:logical  
 NA's:66773     NA's:66773     NA's:66773     NA's:66773    
                                                            
                                                            
                                                            
                                                            
                                                            </code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(inp_labels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-3eb44f6c5d09575d1d8b" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3eb44f6c5d09575d1d8b">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],["DESYNPUF_ID","CLM_ID","SEGMENT","CLM_FROM_DT","CLM_THRU_DT","PRVDR_NUM","CLM_PMT_AMT","NCH_PRMRY_PYR_CLM_PD_AMT","AT_PHYSN_NPI","OP_PHYSN_NPI","OT_PHYSN_NPI","CLM_ADMSN_DT","ADMTNG_ICD9_DGNS_CD","CLM_PASS_THRU_PER_DIEM_AMT","NCH_BENE_IP_DDCTBL_AMT","NCH_BENE_PTA_COINSRNC_LBLTY_AM","NCH_BENE_BLOOD_DDCTBL_LBLTY_AM","CLM_UTLZTN_DAY_CNT","NCH_BENE_DSCHRG_DT","CLM_DRG_CD","ICD9_DGNS_CD_","ICD9_PRCDR_CD_","HCPCS_CD_"],["Beneficiary Code","Claim ID","Claim Line Segment","Claims start date","Claims end date","Provider Institution","Claim Payment Amount","NCH Primary Payer Claim Paid Amount","Attending Physician - National Provider Identifier Number","Operating Physician - National Provider Identifier Number","Other Physician - - National Provider Identifier Number","Inpatient admission date","Claim Admitting Diagnosis Code","Claim Pass Thru Per Diem Amount","NCH Beneficiary Inpatient Deductible Amount","NCH Beneficiary Part A Coinsurance Liability Amount","NCH Beneficiary Blood Deductible Liability Amount","Claim Utilization Day Count","Inpatient discharged date","Claim Diagnosis Related Group Code","Claim Diagnosis Code","Claim Procedure Code","Revenue Center HCFA Common Procedure Coding System"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Name<\/th>\n      <th>Label<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="combining-data" class="level1">
<h1>Combining Data</h1>
<p>There is an overview of joining in the <a href="https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf">data transformation cheat sheet</a>.</p>
<section id="adding-more-rows" class="level2">
<h2 data-anchor-id="adding-more-rows">Adding more rows</h2>
<p>Let’s say we wanted to combine the 2008 and 2009 beneficiary data into a single column. We can accomplish this using the <code>bind_rows</code> function. Before doing this, let’s make sure that the two files contain the same columns. Any missing columns would be filled in with <code>NA</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ben_summary_2008)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "DESYNPUF_ID"              "BENE_BIRTH_DT"           
 [3] "BENE_DEATH_DT"            "BENE_SEX_IDENT_CD"       
 [5] "BENE_RACE_CD"             "BENE_ESRD_IND"           
 [7] "SP_STATE_CODE"            "BENE_COUNTY_CD"          
 [9] "BENE_HI_CVRAGE_TOT_MONS"  "BENE_SMI_CVRAGE_TOT_MONS"
[11] "BENE_HMO_CVRAGE_TOT_MONS" "PLAN_CVRG_MOS_NUM"       
[13] "SP_ALZHDMTA"              "SP_CHF"                  
[15] "SP_CHRNKIDN"              "SP_CNCR"                 
[17] "SP_COPD"                  "SP_DEPRESSN"             
[19] "SP_DIABETES"              "SP_ISCHMCHT"             
[21] "SP_OSTEOPRS"              "SP_RA_OA"                
[23] "SP_STRKETIA"              "MEDREIMB_IP"             
[25] "BENRES_IP"                "PPPYMT_IP"               
[27] "MEDREIMB_OP"              "BENRES_OP"               
[29] "PPPYMT_OP"                "MEDREIMB_CAR"            
[31] "BENRES_CAR"               "PPPYMT_CAR"              </code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ben_summary_2009)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "DESYNPUF_ID"              "BENE_BIRTH_DT"           
 [3] "BENE_DEATH_DT"            "BENE_SEX_IDENT_CD"       
 [5] "BENE_RACE_CD"             "BENE_ESRD_IND"           
 [7] "SP_STATE_CODE"            "BENE_COUNTY_CD"          
 [9] "BENE_HI_CVRAGE_TOT_MONS"  "BENE_SMI_CVRAGE_TOT_MONS"
[11] "BENE_HMO_CVRAGE_TOT_MONS" "PLAN_CVRG_MOS_NUM"       
[13] "SP_ALZHDMTA"              "SP_CHF"                  
[15] "SP_CHRNKIDN"              "SP_CNCR"                 
[17] "SP_COPD"                  "SP_DEPRESSN"             
[19] "SP_DIABETES"              "SP_ISCHMCHT"             
[21] "SP_OSTEOPRS"              "SP_RA_OA"                
[23] "SP_STRKETIA"              "MEDREIMB_IP"             
[25] "BENRES_IP"                "PPPYMT_IP"               
[27] "MEDREIMB_OP"              "BENRES_OP"               
[29] "PPPYMT_OP"                "MEDREIMB_CAR"            
[31] "BENRES_CAR"               "PPPYMT_CAR"              </code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(<span class="fu">colnames</span>(ben_summary_2008) <span class="sc">==</span> <span class="fu">colnames</span>(ben_summary_2009))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>Since everything is the same, let’s go ahead and combine the datasets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>ben_summary <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(ben_summary_2008, ben_summary_2009)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>While the data combined successfully, we likely have introduced duplicates into the table. We’ll see more on how to detect duplicates next session, but for now let’s remove any rows which are an exact match using the <code>unique</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>ben_summary <span class="ot">&lt;-</span> <span class="fu">unique</span>(ben_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, for the rest of the analysis let’s just focus on data from 2008, and just a subset of the total columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>ben_summary <span class="ot">&lt;-</span> ben_summary_2008[,<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>]</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>inp_data <span class="ot">&lt;-</span> inp_data[,<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="merging-datasets-by-matching-values" class="level2">
<h2 data-anchor-id="merging-datasets-by-matching-values">Merging datasets by matching values</h2>
<p>Now we want to combine the beneficiary data with the inpatient data. We can use the various <code>join</code> functions in <code>dyplr</code> to combine the datasets in different ways.</p>
<section id="joining" class="level3">
<h3 data-anchor-id="joining">Joining</h3>
<p>The <code>dyplr</code> functions <code>inner_join</code>, <code>full_join</code>, <code>left_join</code>, and <code>right_join</code> are similar to joins in other languages such as SQL. Their behavior differs in how they handle data which does not have a corresponding match in the other dataset.</p>
<p>In order to join we have to choose what to join on or by, that is, which variable in each dataset will be used to determine whether two rows are matching. In this example, we’ll want to join on <code>DESYNPUF_ID</code>.</p>
<p>In a <strong>full join</strong>, the SQL equivalent of an outer join, all observations from both datasets are kept.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>full_result <span class="ot">&lt;-</span> <span class="fu">full_join</span>(ben_summary, inp_data, <span class="at">by =</span> <span class="st">"DESYNPUF_ID"</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(full_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> DESYNPUF_ID        BENE_BIRTH_DT      BENE_DEATH_DT      BENE_SEX_IDENT_CD
 Length:145345      Min.   :19090101   Min.   :20080101   Min.   :1.000    
 Class :character   1st Qu.:19280301   1st Qu.:20080401   1st Qu.:1.000    
 Mode  :character   Median :19351101   Median :20080701   Median :2.000    
                    Mean   :19360775   Mean   :20080662   Mean   :1.555    
                    3rd Qu.:19420201   3rd Qu.:20081001   3rd Qu.:2.000    
                    Max.   :19831201   Max.   :20081201   Max.   :2.000    
                                       NA's   :143476                      
  BENE_RACE_CD   BENE_ESRD_IND      SP_STATE_CODE      BENE_COUNTY_CD    
 Min.   :1.000   Length:145345      Length:145345      Length:145345     
 1st Qu.:1.000   Class :character   Class :character   Class :character  
 Median :1.000   Mode  :character   Mode  :character   Mode  :character  
 Mean   :1.277                                                           
 3rd Qu.:1.000                                                           
 Max.   :5.000                                                           
                                                                         
     CLM_ID             SEGMENT       CLM_FROM_DT        CLM_THRU_DT      
 Min.   :1.960e+14   Min.   :1       Min.   :20071127   Min.   :20080101  
 1st Qu.:1.963e+14   1st Qu.:1       1st Qu.:20080812   1st Qu.:20080818  
 Median :1.965e+14   Median :1       Median :20090316   Median :20090321  
 Mean   :1.965e+14   Mean   :1       Mean   :20088463   Mean   :20088611  
 3rd Qu.:1.968e+14   3rd Qu.:1       3rd Qu.:20091112   3rd Qu.:20091117  
 Max.   :1.970e+14   Max.   :2       Max.   :20101230   Max.   :20101231  
 NA's   :78572       NA's   :78572   NA's   :78640      NA's   :78640     
  PRVDR_NUM          CLM_PMT_AMT    NCH_PRMRY_PYR_CLM_PD_AMT AT_PHYSN_NPI      
 Length:145345      Min.   :-8000   Min.   :    0.0          Length:145345     
 Class :character   1st Qu.: 4000   1st Qu.:    0.0          Class :character  
 Mode  :character   Median : 7000   Median :    0.0          Mode  :character  
                    Mean   : 9574   Mean   :  398.9                            
                    3rd Qu.:11000   3rd Qu.:    0.0                            
                    Max.   :57000   Max.   :68000.0                            
                    NA's   :78572   NA's   :78572                              
 OP_PHYSN_NPI       OT_PHYSN_NPI        CLM_ADMSN_DT      ADMTNG_ICD9_DGNS_CD
 Length:145345      Length:145345      Min.   :20071127   Length:145345      
 Class :character   Class :character   1st Qu.:20080812   Class :character   
 Mode  :character   Mode  :character   Median :20090316   Mode  :character   
                                       Mean   :20088463                      
                                       3rd Qu.:20091112                      
                                       Max.   :20101230                      
                                       NA's   :78572                         
 CLM_PASS_THRU_PER_DIEM_AMT NCH_BENE_IP_DDCTBL_AMT
 Min.   :  0.00             Min.   :1024          
 1st Qu.:  0.00             1st Qu.:1024          
 Median :  0.00             Median :1068          
 Mean   : 28.98             Mean   :1057          
 3rd Qu.: 10.00             3rd Qu.:1068          
 Max.   :500.00             Max.   :1100          
 NA's   :78572              NA's   :80750         
 NCH_BENE_PTA_COINSRNC_LBLTY_AM NCH_BENE_BLOOD_DDCTBL_LBLTY_AM
 Min.   :    0.00               Min.   :   0.00               
 1st Qu.:    0.00               1st Qu.:   0.00               
 Median :    0.00               Median :   0.00               
 Mean   :   90.03               Mean   :   1.59               
 3rd Qu.:    0.00               3rd Qu.:   0.00               
 Max.   :34000.00               Max.   :2000.00               
 NA's   :78572                  NA's   :78572                 
 CLM_UTLZTN_DAY_CNT NCH_BENE_DSCHRG_DT  CLM_DRG_CD       
 Min.   :  0.00     Min.   :20080101   Length:145345     
 1st Qu.:  2.00     1st Qu.:20080818   Class :character  
 Median :  4.00     Median :20090321   Mode  :character  
 Mean   :  5.58     Mean   :20088612                     
 3rd Qu.:  7.00     3rd Qu.:20091117                     
 Max.   :136.00     Max.   :20101231                     
 NA's   :78640      NA's   :78572                        </code></pre>
</div>
</div>
<p>We can see that this dataset has more rows than either the inpatient data or beneficiary table. This is because we now have rows both for patients in the beneficiaries table but not the inpatient table, and patients in the inpatient table but not the beneficiary table (since the beneficiary table is only from 2008, but the inpatient data is 2008-2010).</p>
<p>We could instead do a <strong>left join</strong>, where we keep all of the inpatient data but drop beneficiaries who had no inpatient data. In this case we expect there to be some drops, but if we knew everything should match we could also set the <code>unmatched</code> argument to <code>"error"</code>. This will tell the function to cause an error if there are unmatched rows, as opposed to dropping them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>left_result <span class="ot">&lt;-</span> <span class="fu">left_join</span>(inp_data, ben_summary, <span class="at">by =</span> <span class="st">"DESYNPUF_ID"</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(left_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> DESYNPUF_ID            CLM_ID             SEGMENT       CLM_FROM_DT      
 Length:66773       Min.   :1.960e+14   Min.   :1.000   Min.   :20071127  
 Class :character   1st Qu.:1.963e+14   1st Qu.:1.000   1st Qu.:20080812  
 Mode  :character   Median :1.965e+14   Median :1.000   Median :20090316  
                    Mean   :1.965e+14   Mean   :1.001   Mean   :20088463  
                    3rd Qu.:1.968e+14   3rd Qu.:1.000   3rd Qu.:20091112  
                    Max.   :1.970e+14   Max.   :2.000   Max.   :20101230  
                                                        NA's   :68        
  CLM_THRU_DT        PRVDR_NUM          CLM_PMT_AMT    NCH_PRMRY_PYR_CLM_PD_AMT
 Min.   :20080101   Length:66773       Min.   :-8000   Min.   :    0.0         
 1st Qu.:20080818   Class :character   1st Qu.: 4000   1st Qu.:    0.0         
 Median :20090321   Mode  :character   Median : 7000   Median :    0.0         
 Mean   :20088611                      Mean   : 9574   Mean   :  398.9         
 3rd Qu.:20091117                      3rd Qu.:11000   3rd Qu.:    0.0         
 Max.   :20101231                      Max.   :57000   Max.   :68000.0         
 NA's   :68                                                                    
 AT_PHYSN_NPI       OP_PHYSN_NPI       OT_PHYSN_NPI        CLM_ADMSN_DT     
 Length:66773       Length:66773       Length:66773       Min.   :20071127  
 Class :character   Class :character   Class :character   1st Qu.:20080812  
 Mode  :character   Mode  :character   Mode  :character   Median :20090316  
                                                          Mean   :20088463  
                                                          3rd Qu.:20091112  
                                                          Max.   :20101230  
                                                                            
 ADMTNG_ICD9_DGNS_CD CLM_PASS_THRU_PER_DIEM_AMT NCH_BENE_IP_DDCTBL_AMT
 Length:66773        Min.   :  0.00             Min.   :1024          
 Class :character    1st Qu.:  0.00             1st Qu.:1024          
 Mode  :character    Median :  0.00             Median :1068          
                     Mean   : 28.98             Mean   :1057          
                     3rd Qu.: 10.00             3rd Qu.:1068          
                     Max.   :500.00             Max.   :1100          
                                                NA's   :2178          
 NCH_BENE_PTA_COINSRNC_LBLTY_AM NCH_BENE_BLOOD_DDCTBL_LBLTY_AM
 Min.   :    0.00               Min.   :   0.00               
 1st Qu.:    0.00               1st Qu.:   0.00               
 Median :    0.00               Median :   0.00               
 Mean   :   90.03               Mean   :   1.59               
 3rd Qu.:    0.00               3rd Qu.:   0.00               
 Max.   :34000.00               Max.   :2000.00               
                                                              
 CLM_UTLZTN_DAY_CNT NCH_BENE_DSCHRG_DT  CLM_DRG_CD        BENE_BIRTH_DT     
 Min.   :  0.000    Min.   :20080101   Length:66773       Min.   :19090101  
 1st Qu.:  2.000    1st Qu.:20080818   Class :character   1st Qu.:19260801  
 Median :  4.000    Median :20090321   Mode  :character   Median :19340501  
 Mean   :  5.583    Mean   :20088612                      Mean   :19351193  
 3rd Qu.:  7.000    3rd Qu.:20091117                      3rd Qu.:19411001  
 Max.   :136.000    Max.   :20101231                      Max.   :19831201  
 NA's   :68                                                                 
 BENE_DEATH_DT      BENE_SEX_IDENT_CD  BENE_RACE_CD   BENE_ESRD_IND     
 Min.   :20080301   Min.   :1.000     Min.   :1.000   Length:66773      
 1st Qu.:20080701   1st Qu.:1.000     1st Qu.:1.000   Class :character  
 Median :20080901   Median :2.000     Median :1.000   Mode  :character  
 Mean   :20080879   Mean   :1.565     Mean   :1.245                     
 3rd Qu.:20081101   3rd Qu.:2.000     3rd Qu.:1.000                     
 Max.   :20081201   Max.   :2.000     Max.   :5.000                     
 NA's   :66586                                                          
 SP_STATE_CODE      BENE_COUNTY_CD    
 Length:66773       Length:66773      
 Class :character   Class :character  
 Mode  :character   Mode  :character  
                                      
                                      
                                      
                                      </code></pre>
</div>
</div>
<p>There are also <strong>inner joins</strong>, where only rows which match are kept. We’ll see more analysis with the synthetic CMS dataset next session.</p>
</section>
</section>
</section>
<section id="creating-new-columns" class="level1">
<h1>Creating new columns</h1>
<section id="data" class="level2">
<h2 data-anchor-id="data">Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>nhanes <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/nhanes_diabetes.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mutate" class="level2">
<h2 data-anchor-id="mutate">Mutate</h2>
<p>Frequently you’ll want to create new columns based on the values of existing columns, for example to do unit conversions, or to find the ratio of values in two columns. For this we’ll use <code>mutate()</code>.</p>
<p>To create a new column of age in months:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>nhanes <span class="sc">%&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age.months =</span> RIDAGEYR <span class="sc">*</span> <span class="dv">12</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(age.months, RIDAGEYR) <span class="sc">%&gt;%</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  age.months RIDAGEYR
1          0        0
2        132       11
3        180       15
4       1020       85
5        528       44
6        840       70</code></pre>
</div>
</div>
<p>You can also create a second new column based on the first new column within the same call of <code>mutate()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>nhanes <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age.months =</span> RIDAGEYR <span class="sc">*</span> <span class="dv">12</span>,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">lived_200_months =</span> age.months <span class="sc">&gt;=</span> <span class="dv">200</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(age.months, RIDAGEYR, lived_200_months) <span class="sc">%&gt;%</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  age.months RIDAGEYR lived_200_months
1          0        0            FALSE
2        132       11            FALSE
3        180       15            FALSE
4       1020       85             TRUE
5        528       44             TRUE
6        840       70             TRUE</code></pre>
</div>
</div>
</section>
<section id="split-apply-combine-data-analysis" class="level2">
<h2 data-anchor-id="split-apply-combine-data-analysis">Split-apply-combine data analysis</h2>
<p>Many data analysis tasks can be approached using the <em>split-apply-combine</em> paradigm: split the data into groups, apply some analysis to each group, and then combine the results. <strong><code>dplyr</code></strong> makes this very easy through the use of the <code>group_by()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>nhanes <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(DMDBORN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 31,034 × 28
# Groups:   DMDBORN [7]
       X  SEQN RIDAGEYR RIAGENDR RIDRETH1      DMDBORN INDFMPIR SDMVPSU SDMVSTRA
   &lt;int&gt; &lt;int&gt;    &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;         &lt;chr&gt;      &lt;dbl&gt;   &lt;int&gt;    &lt;int&gt;
 1     1 31127        0 Male     Non-Hispanic… Born i…     0.75       2       44
 2     2 31128       11 Female   Non-Hispanic… Born i…     0.77       1       52
 3     3 31129       15 Male     Non-Hispanic… Born i…     2.71       1       51
 4     4 31130       85 Female   Non-Hispanic… Born i…     1.99       2       46
 5     5 31131       44 Female   Non-Hispanic… Born i…     4.65       1       48
 6     6 31132       70 Male     Non-Hispanic… Born i…     5          2       52
 7     7 31133       16 Female   Non-Hispanic… Born i…     5          1       51
 8     8 31134       73 Male     Non-Hispanic… Born i…    NA          2       48
 9     9 31135        0 Male     Other Race -… Born i…     5          2       52
10    10 31136       41 Female   Non-Hispanic… Born i…     3.57       2       51
# ℹ 31,024 more rows
# ℹ 19 more variables: WTINT2YR &lt;dbl&gt;, WTMEC2YR &lt;dbl&gt;, OHXDECAY &lt;lgl&gt;,
#   OHXREST &lt;lgl&gt;, LBXGLU &lt;int&gt;, WTSAF2YR &lt;dbl&gt;, LBXGH &lt;dbl&gt;, BMXBMI &lt;dbl&gt;,
#   Begin.Year &lt;int&gt;, EndYear &lt;int&gt;, age.cat &lt;chr&gt;, LBXGH.cat &lt;chr&gt;,
#   RIDAGEYR.cat &lt;chr&gt;, LBXGLU.cat &lt;chr&gt;, BMXBMI.cat &lt;chr&gt;, INDFMPIR.cat &lt;chr&gt;,
#   DMDBORN.cat &lt;chr&gt;, dental.caries &lt;lgl&gt;, diabetes &lt;chr&gt;</code></pre>
</div>
</div>
<p>The <code>group_by()</code> function doesn’t perform any data processing, it groups the data into subsets: in the example above, our initial <code>tibble</code> of 31034 observations is split into 7 groups based on the <code>DMDBORN</code> variable.</p>
<p>We could similarly decide to group the tibble by sex:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>nhanes <span class="sc">%&gt;%</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(RIAGENDR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 31,034 × 28
# Groups:   RIAGENDR [2]
       X  SEQN RIDAGEYR RIAGENDR RIDRETH1      DMDBORN INDFMPIR SDMVPSU SDMVSTRA
   &lt;int&gt; &lt;int&gt;    &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;         &lt;chr&gt;      &lt;dbl&gt;   &lt;int&gt;    &lt;int&gt;
 1     1 31127        0 Male     Non-Hispanic… Born i…     0.75       2       44
 2     2 31128       11 Female   Non-Hispanic… Born i…     0.77       1       52
 3     3 31129       15 Male     Non-Hispanic… Born i…     2.71       1       51
 4     4 31130       85 Female   Non-Hispanic… Born i…     1.99       2       46
 5     5 31131       44 Female   Non-Hispanic… Born i…     4.65       1       48
 6     6 31132       70 Male     Non-Hispanic… Born i…     5          2       52
 7     7 31133       16 Female   Non-Hispanic… Born i…     5          1       51
 8     8 31134       73 Male     Non-Hispanic… Born i…    NA          2       48
 9     9 31135        0 Male     Other Race -… Born i…     5          2       52
10    10 31136       41 Female   Non-Hispanic… Born i…     3.57       2       51
# ℹ 31,024 more rows
# ℹ 19 more variables: WTINT2YR &lt;dbl&gt;, WTMEC2YR &lt;dbl&gt;, OHXDECAY &lt;lgl&gt;,
#   OHXREST &lt;lgl&gt;, LBXGLU &lt;int&gt;, WTSAF2YR &lt;dbl&gt;, LBXGH &lt;dbl&gt;, BMXBMI &lt;dbl&gt;,
#   Begin.Year &lt;int&gt;, EndYear &lt;int&gt;, age.cat &lt;chr&gt;, LBXGH.cat &lt;chr&gt;,
#   RIDAGEYR.cat &lt;chr&gt;, LBXGLU.cat &lt;chr&gt;, BMXBMI.cat &lt;chr&gt;, INDFMPIR.cat &lt;chr&gt;,
#   DMDBORN.cat &lt;chr&gt;, dental.caries &lt;lgl&gt;, diabetes &lt;chr&gt;</code></pre>
</div>
</div>
<p>Once the data has been grouped, subsequent operations will be applied on each group independently.</p>
<section id="the-summarise-function" class="level3">
<h3 data-anchor-id="the-summarise-function">The <code>summarise()</code> function</h3>
<p><code>group_by()</code> is often used together with <code>summarise()</code>, which collapses each group into a single-row summary of that group.</p>
<p><code>group_by()</code> takes as arguments the column names that contain the <strong>categorical</strong> variables for which you want to calculate the summary statistics. So to compute the mean <code>BMXBMI</code> by birthplace:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>nhanes <span class="sc">%&gt;%</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(DMDBORN) <span class="sc">%&gt;%</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_bmi =</span> <span class="fu">mean</span>(BMXBMI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 2
  DMDBORN                        mean_bmi
  &lt;chr&gt;                             &lt;dbl&gt;
1 Born Elsewhere                     25.4
2 Born in 50 US States or Washi      25.3
3 Born in Mexico                     27.5
4 Born in Other Non-Spanish Spea     25.8
5 Born in Other Spanish Speaking     27.9
6 Don't Know                         22.9
7 Refused                            23.8</code></pre>
</div>
</div>
<p>We can can also group by multiple columns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>nhanes <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(RIAGENDR, RIDRETH1) <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_bmi =</span> <span class="fu">mean</span>(BMXBMI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'RIAGENDR'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
# Groups:   RIAGENDR [2]
   RIAGENDR RIDRETH1                       mean_bmi
   &lt;chr&gt;    &lt;chr&gt;                             &lt;dbl&gt;
 1 Female   Mexican American                   25.3
 2 Female   Non-Hispanic Black                 27.3
 3 Female   Non-Hispanic White                 25.9
 4 Female   Other Hispanic                     25.8
 5 Female   Other Race - Including Multi-R     23.2
 6 Male     Mexican American                   24.6
 7 Male     Non-Hispanic Black                 25.1
 8 Male     Non-Hispanic White                 25.9
 9 Male     Other Hispanic                     25.1
10 Male     Other Race - Including Multi-R     23.0</code></pre>
</div>
</div>
<p>Once the data is grouped, you can also summarise multiple variables at the same time (and not necessarily on the same variable). For instance, we could add a column indicating the median plasma glucose by sex and ethnicity:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>nhanes <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(RIAGENDR, RIDRETH1) <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_plasma_glucose =</span> <span class="fu">mean</span>(LBXGLU),</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">median_plasma_glucose =</span> <span class="fu">median</span>(LBXGLU))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'RIAGENDR'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
# Groups:   RIAGENDR [2]
   RIAGENDR RIDRETH1                   mean_plasma_glucose median_plasma_glucose
   &lt;chr&gt;    &lt;chr&gt;                                    &lt;dbl&gt;                 &lt;int&gt;
 1 Female   Mexican American                            NA                    NA
 2 Female   Non-Hispanic Black                          NA                    NA
 3 Female   Non-Hispanic White                          NA                    NA
 4 Female   Other Hispanic                              NA                    NA
 5 Female   Other Race - Including Mu…                  NA                    NA
 6 Male     Mexican American                            NA                    NA
 7 Male     Non-Hispanic Black                          NA                    NA
 8 Male     Non-Hispanic White                          NA                    NA
 9 Male     Other Hispanic                              NA                    NA
10 Male     Other Race - Including Mu…                  NA                    NA</code></pre>
</div>
</div>
</section>
<section id="counting" class="level3">
<h3 data-anchor-id="counting">Counting</h3>
<p>When working with data, we often want to know the number of observations found for each factor or combination of factors. For this task, <strong><code>dplyr</code></strong> provides <code>count()</code>. For example, if we wanted to count the number of rows of data for each age, we would do:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>nhanes <span class="sc">%&gt;%</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(RIDAGEYR) <span class="sc">%&gt;%</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">datatable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-48655a20661ef4baeeba" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-48655a20661ef4baeeba">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86"],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85],[1437,987,990,621,716,622,610,606,629,593,610,616,618,583,610,612,640,616,599,587,295,319,316,314,290,297,288,274,303,310,294,297,289,275,285,278,302,272,300,318,333,277,265,288,304,305,299,272,265,291,298,304,272,284,265,243,240,195,215,204,357,338,314,270,250,244,239,240,201,195,226,229,209,213,200,178,178,157,167,134,910,59,44,39,36,170]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>RIDAGEYR<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>The <code>count()</code> function is shorthand for something we’ve already seen: grouping by a variable, and summarising it by counting the number of observations in that group. In other words, <code>nhanes %&gt;% count(age.years)</code> is equivalent to:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>nhanes <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(RIDAGEYR) <span class="sc">%&gt;%</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 86 × 2
   RIDAGEYR     n
      &lt;int&gt; &lt;int&gt;
 1        0  1437
 2        1   987
 3        2   990
 4        3   621
 5        4   716
 6        5   622
 7        6   610
 8        7   606
 9        8   629
10        9   593
# ℹ 76 more rows</code></pre>
</div>
</div>
<p>The previous example shows the use of <code>count()</code> to count the number of rows/observations for <em>one</em> factor (i.e., <code>infection</code>). If we wanted to count a <em>combination of factors</em>, such as <code>age</code> and <code>sex</code>, we would specify the first and the second factor as the arguments of <code>count()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>nhanes <span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(RIDAGEYR, RIAGENDR)  <span class="sc">%&gt;%</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">datatable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-e2412a1273ae516a27d8" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e2412a1273ae516a27d8">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172"],[0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,14,14,15,15,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,30,30,31,31,32,32,33,33,34,34,35,35,36,36,37,37,38,38,39,39,40,40,41,41,42,42,43,43,44,44,45,45,46,46,47,47,48,48,49,49,50,50,51,51,52,52,53,53,54,54,55,55,56,56,57,57,58,58,59,59,60,60,61,61,62,62,63,63,64,64,65,65,66,66,67,67,68,68,69,69,70,70,71,71,72,72,73,73,74,74,75,75,76,76,77,77,78,78,79,79,80,80,81,81,82,82,83,83,84,84,85,85],["Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male"],[694,743,472,515,486,504,309,312,347,369,292,330,306,304,288,318,309,320,311,282,298,312,319,297,301,317,291,292,310,300,300,312,306,334,294,322,306,293,265,322,159,136,170,149,170,146,178,136,155,135,162,135,156,132,150,124,167,136,172,138,163,131,164,133,147,142,151,124,146,139,134,144,154,148,136,136,163,137,148,170,170,163,139,138,142,123,146,142,174,130,170,135,153,146,153,119,121,144,146,145,141,157,147,157,139,133,129,155,124,141,110,133,117,123,89,106,117,98,112,92,189,168,168,170,155,159,146,124,127,123,117,127,105,134,135,105,92,109,93,102,111,115,119,110,103,106,116,97,108,92,88,90,88,90,83,74,69,98,62,72,482,428,30,29,16,28,20,19,18,18,105,65]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>RIDAGEYR<\/th>\n      <th>RIAGENDR<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>It is sometimes useful to sort the result to facilitate the comparisons. We can use <code>arrange()</code> to sort the table. For instance, we might want to arrange the table above by age:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>nhanes <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(RIDAGEYR, RIAGENDR) <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(RIDAGEYR)  <span class="sc">%&gt;%</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">datatable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-2536db92b52b0c976d09" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-2536db92b52b0c976d09">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172"],[0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,14,14,15,15,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,30,30,31,31,32,32,33,33,34,34,35,35,36,36,37,37,38,38,39,39,40,40,41,41,42,42,43,43,44,44,45,45,46,46,47,47,48,48,49,49,50,50,51,51,52,52,53,53,54,54,55,55,56,56,57,57,58,58,59,59,60,60,61,61,62,62,63,63,64,64,65,65,66,66,67,67,68,68,69,69,70,70,71,71,72,72,73,73,74,74,75,75,76,76,77,77,78,78,79,79,80,80,81,81,82,82,83,83,84,84,85,85],["Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male"],[694,743,472,515,486,504,309,312,347,369,292,330,306,304,288,318,309,320,311,282,298,312,319,297,301,317,291,292,310,300,300,312,306,334,294,322,306,293,265,322,159,136,170,149,170,146,178,136,155,135,162,135,156,132,150,124,167,136,172,138,163,131,164,133,147,142,151,124,146,139,134,144,154,148,136,136,163,137,148,170,170,163,139,138,142,123,146,142,174,130,170,135,153,146,153,119,121,144,146,145,141,157,147,157,139,133,129,155,124,141,110,133,117,123,89,106,117,98,112,92,189,168,168,170,155,159,146,124,127,123,117,127,105,134,135,105,92,109,93,102,111,115,119,110,103,106,116,97,108,92,88,90,88,90,83,74,69,98,62,72,482,428,30,29,16,28,20,19,18,18,105,65]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>RIDAGEYR<\/th>\n      <th>RIAGENDR<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>or by counts:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>nhanes <span class="sc">%&gt;%</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(RIDAGEYR, RIAGENDR) <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(n)  <span class="sc">%&gt;%</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">datatable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-d07fadf188a62d1f9582" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-d07fadf188a62d1f9582">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172"],[82,84,84,83,83,82,81,81,79,85,78,79,77,77,75,76,57,75,76,59,68,74,69,73,58,78,69,72,66,67,85,57,72,74,68,55,71,70,59,70,73,56,58,65,47,71,48,42,56,64,27,33,54,63,64,65,53,44,30,26,31,52,55,35,66,24,25,45,67,20,23,28,37,37,38,29,41,34,41,52,50,54,32,42,43,35,48,49,22,34,43,46,49,63,32,51,36,39,21,27,33,46,47,36,24,53,62,26,50,51,20,62,25,30,38,40,31,28,60,61,21,22,39,40,45,61,29,44,23,60,19,9,7,13,5,13,18,17,11,10,14,15,12,6,6,16,18,3,8,14,9,3,10,15,12,7,11,8,17,19,5,16,4,4,80,1,80,2,2,1,0,0],["Female","Female","Male","Male","Female","Male","Male","Female","Female","Male","Female","Male","Male","Female","Female","Female","Female","Male","Male","Male","Female","Male","Female","Male","Male","Male","Male","Female","Female","Male","Female","Male","Male","Female","Male","Female","Male","Female","Female","Male","Female","Female","Female","Female","Male","Female","Female","Male","Male","Male","Male","Male","Female","Male","Female","Male","Female","Male","Male","Male","Male","Male","Male","Female","Male","Male","Male","Male","Female","Male","Male","Male","Female","Male","Male","Male","Male","Male","Female","Female","Female","Male","Male","Female","Male","Male","Male","Male","Male","Female","Female","Male","Female","Female","Female","Female","Male","Female","Male","Female","Female","Female","Female","Female","Female","Male","Female","Female","Male","Male","Female","Male","Female","Female","Female","Male","Female","Female","Male","Female","Female","Female","Male","Female","Female","Male","Female","Female","Female","Female","Female","Male","Female","Female","Female","Male","Male","Female","Male","Female","Male","Female","Female","Male","Female","Female","Female","Female","Female","Female","Female","Male","Male","Male","Male","Male","Female","Male","Male","Male","Male","Male","Female","Male","Male","Female","Female","Female","Male","Male","Female","Male"],[16,18,18,19,20,28,29,30,62,65,69,72,74,83,88,88,89,90,90,92,92,92,93,97,98,98,102,103,105,105,105,106,106,108,109,110,110,111,112,115,116,117,117,117,119,119,121,123,123,123,124,124,124,124,127,127,129,130,131,132,133,133,133,134,134,135,135,135,135,136,136,136,136,136,137,138,138,139,139,139,141,141,142,142,142,144,144,145,146,146,146,146,146,146,147,147,148,148,149,150,151,153,153,154,155,155,155,156,157,157,159,159,162,163,163,163,164,167,168,168,170,170,170,170,170,170,172,174,178,189,265,282,288,291,292,292,293,294,297,298,300,300,301,304,306,306,306,309,309,310,311,312,312,312,317,318,319,320,322,322,330,334,347,369,428,472,482,486,504,515,694,743]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>RIDAGEYR<\/th>\n      <th>RIAGENDR<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>To sort in descending order, we need to add the <code>desc()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>nhanes <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(RIDAGEYR, RIAGENDR) <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(n))  <span class="sc">%&gt;%</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">datatable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-0a2b75217429385ee616" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-0a2b75217429385ee616">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172"],[0,0,1,2,2,80,1,80,4,4,16,5,17,19,8,11,7,12,3,10,15,9,14,3,8,6,16,18,6,12,14,15,10,11,17,18,5,13,13,7,9,19,60,23,44,29,21,22,39,40,45,61,60,61,28,31,30,38,40,25,20,62,50,51,26,24,53,62,36,46,47,33,27,21,36,39,32,51,22,34,43,46,49,63,49,35,48,32,42,43,50,54,34,41,52,29,41,38,20,23,28,37,37,24,25,45,67,35,66,31,52,55,26,30,44,53,64,65,27,33,54,63,42,56,64,48,47,71,56,58,65,73,70,59,70,55,71,68,74,57,72,66,67,85,72,69,58,78,73,69,59,68,74,75,76,57,75,76,77,77,79,78,85,79,81,81,82,83,83,84,84,82],["Male","Female","Male","Male","Female","Female","Female","Male","Male","Female","Male","Male","Male","Male","Male","Female","Male","Male","Male","Male","Male","Female","Female","Female","Female","Female","Female","Female","Male","Female","Male","Female","Female","Male","Female","Male","Female","Male","Female","Female","Male","Female","Female","Female","Female","Female","Female","Female","Male","Female","Female","Male","Male","Female","Female","Female","Female","Female","Male","Female","Female","Male","Male","Male","Female","Female","Male","Female","Female","Female","Female","Female","Female","Male","Male","Female","Female","Female","Male","Female","Female","Male","Female","Female","Male","Male","Male","Male","Female","Male","Female","Male","Male","Female","Female","Male","Male","Male","Male","Male","Male","Female","Male","Male","Male","Male","Female","Female","Male","Male","Male","Male","Male","Male","Male","Female","Female","Male","Male","Male","Female","Male","Male","Male","Male","Female","Male","Female","Female","Female","Female","Female","Male","Female","Female","Female","Male","Male","Female","Male","Male","Female","Male","Female","Female","Male","Male","Male","Male","Female","Male","Female","Male","Male","Male","Female","Female","Female","Female","Male","Male","Female","Male","Female","Female","Male","Male","Female","Male","Female","Male","Female"],[743,694,515,504,486,482,472,428,369,347,334,330,322,322,320,319,318,317,312,312,312,311,310,309,309,306,306,306,304,301,300,300,298,297,294,293,292,292,291,288,282,265,189,178,174,172,170,170,170,170,170,170,168,168,167,164,163,163,163,162,159,159,157,157,156,155,155,155,154,153,153,151,150,149,148,148,147,147,146,146,146,146,146,146,145,144,144,142,142,142,141,141,139,139,139,138,138,137,136,136,136,136,136,135,135,135,135,134,134,133,133,133,132,131,130,129,127,127,124,124,124,124,123,123,123,121,119,119,117,117,117,116,115,112,111,110,110,109,108,106,106,105,105,105,103,102,98,98,97,93,92,92,92,90,90,89,88,88,83,74,72,69,65,62,30,29,28,20,19,18,18,16]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>RIDAGEYR<\/th>\n      <th>RIAGENDR<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
</section>
<section id="data-cleaning-pipeline" class="level1">
<h1>Data cleaning pipeline</h1>
<p>Let’s load the raw version of the nhanes data we looked at during the first two sessions. This data is stored in the SAS transport <code>.xpt</code> format, so we’ll read it in using the <code>read_xpt</code> function from the <code>haven</code> package. <code>haven</code> also has a <code>read_sas</code> function for reading <code>sas7bdat</code> data, as well as functions for reading and writing Stata and SPSS formats.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>nhanes_raw <span class="ot">&lt;-</span> <span class="fu">read_xpt</span>(<span class="st">"../data/raw_nhanes.xpt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We want to start by converting each variable to it’s appropriate type or category.</p>
<section id="numeric-variables" class="level2">
<h2 data-anchor-id="numeric-variables">Numeric variables</h2>
<p>Let’s start by converting numeric columns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set numeric columns to be numeric</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>nhanes_clean <span class="ot">&lt;-</span> <span class="fu">mutate</span>(nhanes_raw,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">RIDAGEYR =</span> <span class="fu">as.numeric</span>(RIDAGEYR),</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">LBXGLU =</span> <span class="fu">as.numeric</span>(LBXGLU),</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">LBXGH =</span> <span class="fu">as.numeric</span>(LBXGH),</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">BMXBMI =</span> <span class="fu">as.numeric</span>(BMXBMI))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="categorical-variables" class="level2">
<h2 data-anchor-id="categorical-variables">Categorical variables</h2>
<p>Many of the NHANES values are categorical data, but right now are stored as text. We can check what values exist by converting them to factors before making the decision of how to handle them in the analysis:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>nhanes_clean <span class="sc">|&gt;</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(RIAGENDR, RIDRETH1, DMDBORN), as.factor), <span class="at">.keep =</span> <span class="st">"none"</span>) <span class="sc">|&gt;</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   RIAGENDR                               RIDRETH1    
 Female:15633   Mexican American              : 7388  
 Male  :15401   Non-Hispanic Black            : 6878  
                Non-Hispanic White            :12463  
                Other Hispanic                : 2683  
                Other Race - Including Multi-R: 1622  
                                                      
                                                      
                           DMDBORN     
 "Born in 50 US States or Washi:25732  
 Born Elsewhere                :  588  
 Born in Mexico                : 2511  
 Born in Other Non-Spanish Spea: 1065  
 Born in Other Spanish Speaking: 1120  
 Don't Know                    :    2  
 Refused                       :   16  </code></pre>
</div>
</div>
<p>Let’s recode the “Other Race - Including Multi-R” ethnicity value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>nhanes_clean <span class="ot">&lt;-</span> nhanes_clean <span class="sc">|&gt;</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RIDRETH1 =</span> </span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">recode</span>(RIDRETH1, <span class="st">"Other Race - Including Multi-R"</span> <span class="ot">=</span> <span class="st">"Other/Multi-Racial"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It looks like one of the options for <code>DMDBORN</code> has a lingering quote character. This can happen due to irregularities in how NHANES data is presented or small mistakes in data processing. We use the <code>gsub</code> function to replace all instances of double quotes with the empty string in the column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>nhanes_clean <span class="ot">&lt;-</span> <span class="fu">mutate</span>(nhanes_clean,</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">RIAGENDR =</span> <span class="fu">as.factor</span>(RIAGENDR),</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">RIDRETH1 =</span> <span class="fu">as.factor</span>(RIDRETH1),</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">DMDBORN =</span> <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\"</span><span class="st">"</span>, <span class="st">""</span>, DMDBORN), <span class="co"># Remove quotes</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">DMDBORN =</span> <span class="fu">as.factor</span>(DMDBORN),</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">OHXDECAY =</span> (OHXDECAY <span class="sc">==</span> <span class="st">"Yes"</span>),</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">OHXREST =</span> (OHXREST <span class="sc">==</span> <span class="st">"Yes"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>gsub</code> is a useful function which will replace all matching string instances based on a regular expression. There is a corresponding <code>sub</code> function which only replaces the first match. Regular expressions in R are mostly identical to other implementations. There is a cheatsheet on string manipulation in R, including a regular expression reference, <a href="https://evoldyn.gitlab.io/evomics-2018/ref-sheets/R_strings.pdf">here</a>.</p>
</section>
<section id="new-variables" class="level2">
<h2 data-anchor-id="new-variables">New variables</h2>
<section id="making-ages-with-cut" class="level3">
<h3 data-anchor-id="making-ages-with-cut">Making ages with cut</h3>
<p>We might want to make age categories for our data in addition to having age in years. We can do this using the <code>cut</code> function in base R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(nhanes_raw,</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">age.cat =</span> <span class="fu">cut</span>(</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>          RIDAGEYR,</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">18</span>, <span class="dv">65</span>, <span class="fu">max</span>(RIDAGEYR)),</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">include.lowest =</span> <span class="cn">TRUE</span>,</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">right =</span> <span class="cn">FALSE</span>,</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Under 18"</span>,<span class="st">"18-65"</span>,<span class="st">"65+"</span>)</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>          )) <span class="sc">|&gt;</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age.cat) <span class="sc">|&gt;</span> <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
# Groups:   age.cat [3]
  age.cat      n
  &lt;fct&gt;    &lt;int&gt;
1 Under 18 12716
2 18-65    14050
3 65+       4268</code></pre>
</div>
</div>
<p>We can also generate categories using <code>seq</code> and labels using <code>paste0</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>age_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">90</span>, <span class="at">by =</span> <span class="dv">10</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(nhanes_raw,</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">age.cat =</span> <span class="fu">cut</span>(</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>          RIDAGEYR,</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks =</span> age_seq,</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">include.lowest =</span> <span class="cn">TRUE</span>,</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">labels =</span> <span class="fu">paste0</span>(age_seq[<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>] <span class="sc">+</span> <span class="dv">1</span>, <span class="st">"-"</span>, age_seq[<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>] <span class="sc">+</span> <span class="dv">10</span>)</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>          )) <span class="sc">|&gt;</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age.cat) <span class="sc">|&gt;</span> <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 2
# Groups:   age.cat [9]
  age.cat     n
  &lt;fct&gt;   &lt;int&gt;
1 1-10     8421
2 11-20    5776
3 21-30    3005
4 31-40    2949
5 41-50    2864
6 51-60    2579
7 61-70    2517
8 71-80    2575
9 81-90     348</code></pre>
</div>
</div>
<p>We can also make quantile breaks for numeric values using the <code>quantile</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(nhanes_raw,</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">glucose.cat =</span> <span class="fu">cut</span>(</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>          LBXGLU,</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks =</span> <span class="fu">quantile</span>(</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>            LBXGLU,</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.1</span>),</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">include.lowest =</span> <span class="cn">TRUE</span>,</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>          )) <span class="sc">|&gt;</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(glucose.cat) <span class="sc">|&gt;</span> <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 2
# Groups:   glucose.cat [11]
   glucose.cat     n
   &lt;fct&gt;       &lt;int&gt;
 1 [36,86]      1145
 2 (86,90]      1021
 3 (90,93]       990
 4 (93,95]       763
 5 (95,98]      1036
 6 (98,101]      994
 7 (101,105]     994
 8 (105,111]     864
 9 (111,125]     868
10 (125,584]     949
11 &lt;NA&gt;        21410</code></pre>
</div>
</div>
<p>If we want to make more complex categories, we can use the base R <code>ifelse</code> function or <code>case_when</code> in tidyverse.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set columns to categories as in the paper</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>nhanes_clean <span class="ot">&lt;-</span> <span class="fu">mutate</span>(nhanes_clean,</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">age.cat =</span> <span class="fu">cut</span>(</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>                      RIDAGEYR,</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">13</span>, <span class="dv">15</span>, <span class="dv">18</span>, <span class="dv">100</span>),</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">include.lowest =</span> <span class="cn">TRUE</span>,</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"13-15"</span>, <span class="st">"16-18"</span>, <span class="st">"19+"</span>)),</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">plasma.glucose.cat =</span> <span class="fu">case_when</span>(</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>                     LBXGLU <span class="sc">&lt;</span> <span class="dv">100</span> <span class="sc">~</span> <span class="st">"&lt;100 mg/dl"</span>,</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>                     LBXGLU <span class="sc">&lt;</span> <span class="dv">126</span> <span class="sc">~</span> <span class="st">"&gt;=100 mg/dl and &lt;126 mg/dl"</span>, </span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>                     LBXGLU <span class="sc">&gt;=</span> <span class="dv">126</span> <span class="sc">~</span> <span class="st">"&gt;=126 mg/dl"</span>,</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">.default =</span> <span class="cn">NA</span>),</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">hba1c.cat =</span> <span class="fu">case_when</span>(</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>                     LBXGH <span class="sc">&lt;</span> <span class="fl">5.7</span> <span class="sc">~</span> <span class="st">"&lt;5.7%"</span>,</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>                     LBXGH <span class="sc">&gt;=</span> <span class="fl">5.7</span> <span class="sc">~</span> <span class="st">"&gt;=5.7% and &lt;6.5%"</span>,</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>                     LBXGH <span class="sc">&gt;=</span> <span class="fl">6.5</span> <span class="sc">~</span> <span class="st">"&gt;= 6.5%"</span>,</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">.default =</span> <span class="cn">NA</span>),</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>                   <span class="at">bmi.cat =</span> <span class="fu">case_when</span>( </span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>                     BMXBMI <span class="sc">&lt;</span> <span class="dv">25</span> <span class="sc">~</span> <span class="st">"Normal"</span>, </span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>                     BMXBMI <span class="sc">&lt;</span> <span class="dv">30</span> <span class="sc">~</span> <span class="st">"Overweight"</span>,</span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>                     BMXBMI <span class="sc">&gt;=</span> <span class="dv">30</span> <span class="sc">~</span> <span class="st">"Obese"</span>,</span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>                     <span class="at">.default =</span> <span class="cn">NA</span>), </span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family.PIR.cat =</span> <span class="fu">case_when</span>(</span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>                     INDFMPIR <span class="sc">==</span> <span class="st">"PIR value greater than or equa"</span> <span class="sc">~</span> <span class="st">"&gt;= 1"</span>,</span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a>                     INDFMPIR <span class="sc">==</span> <span class="st">"Value greater than or equal to"</span> <span class="sc">~</span> <span class="st">"&gt;= 1"</span>,</span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">as.numeric</span>(INDFMPIR) <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"&gt;=1"</span>,</span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">as.numeric</span>(INDFMPIR) <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"&lt;1"</span>,</span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a>                     <span class="at">.default =</span> <span class="cn">NA</span>),</span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a>                   <span class="at">birthplace =</span> <span class="fu">case_when</span>(</span>
<span id="cb68-35"><a href="#cb68-35" aria-hidden="true" tabindex="-1"></a>                     DMDBORN <span class="sc">==</span> <span class="st">"Born in 50 US States or Washi"</span> <span class="sc">~</span> <span class="st">"Within the US"</span>,</span>
<span id="cb68-36"><a href="#cb68-36" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">is.na</span>(DMDBORN) <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb68-37"><a href="#cb68-37" aria-hidden="true" tabindex="-1"></a>                     DMDBORN <span class="sc">==</span> <span class="st">"Don't Know"</span> <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb68-38"><a href="#cb68-38" aria-hidden="true" tabindex="-1"></a>                     DMDBORN <span class="sc">==</span> <span class="st">"Refused"</span> <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb68-39"><a href="#cb68-39" aria-hidden="true" tabindex="-1"></a>                    <span class="at">.default =</span> <span class="st">"Outside the US"</span>),</span>
<span id="cb68-40"><a href="#cb68-40" aria-hidden="true" tabindex="-1"></a>                   <span class="at">dental.caries =</span> OHXDECAY <span class="sc">|</span> OHXREST)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using <code>ifelse</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add diabetes column</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>nhanes_clean <span class="ot">&lt;-</span> nhanes_clean <span class="sc">|&gt;</span> </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">diabetes =</span> </span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">ifelse</span>(LBXGH <span class="sc">&gt;=</span> <span class="fl">6.5</span> <span class="sc">|</span> LBXGLU <span class="sc">&gt;=</span> <span class="dv">126</span>, <span class="st">"diabetic"</span>,</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>           <span class="fu">ifelse</span>(LBXGH <span class="sc">&gt;=</span> <span class="fl">5.7</span> <span class="sc">|</span> LBXGLU <span class="sc">&gt;=</span> <span class="dv">100</span>, <span class="st">"nondiabetic"</span>,</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>           <span class="fu">ifelse</span>(<span class="fu">is.na</span>(<span class="fu">is.na</span>(LBXGH) <span class="sc">&amp;</span> <span class="fu">is.na</span>(LBXGLU)),<span class="cn">NA</span>,</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"nondiabetic"</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="string-manipulation" class="level1">
<h1>String Manipulation</h1>
<section id="combining-and-joining-strings" class="level2">
<h2 data-anchor-id="combining-and-joining-strings">Combining and joining strings</h2>
<p>Let’s go through some common string manipulations in R. We’ve already seen <code>gsub</code> and <code>sub</code>. We will now be using functions from the <code>stringr</code> package, which provide a consistent naming structure.</p>
<p>First, we can use <code>str_c</code> to combine strings.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_c</span>(<span class="st">"String1"</span>, <span class="st">"String2"</span>, <span class="st">"String3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "String1String2String3"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_c</span>(<span class="st">"String1"</span>, <span class="st">"String2"</span>, <span class="st">"String3"</span>, <span class="at">sep =</span> <span class="st">", "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "String1, String2, String3"</code></pre>
</div>
</div>
<p>Vectors of strings will be combined by element, and we can specify both <code>seq</code> and <code>collapse</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>first_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"abdul"</span>, <span class="st">"fahruk"</span>, <span class="st">"janice"</span>) </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>last_names  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"hussein"</span>, <span class="st">"akinleye"</span>, <span class="st">"okeke"</span>)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co"># sep displays between the respective input strings, while collapse displays between the elements produced</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str_c</span>(first_names, last_names, <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">collapse =</span> <span class="st">";  "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "abdul hussein;  fahruk akinleye;  janice okeke"</code></pre>
</div>
</div>
<p>We can split strings with <code>str_split</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_split</span>(<span class="at">string =</span> <span class="st">"jaundice, fever, chills"</span>,</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">pattern =</span> <span class="st">","</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "jaundice" " fever"   " chills" </code></pre>
</div>
</div>
</section>
<section id="combining-and-joining-columns" class="level2">
<h2 data-anchor-id="combining-and-joining-columns">Combining and joining columns</h2>
<p>Let’s make a small dataframe to demonstrate splitting and combining on columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a small example dataframe</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">case_ID =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>),</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">symptoms  =</span> <span class="fu">c</span>(<span class="st">"jaundice, fever, chills"</span>,     <span class="co"># patient 1</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">"chills, aches, pains"</span>,        <span class="co"># patient 2 </span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">"fever"</span>,                       <span class="co"># patient 3</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">"vomiting, diarrhoea"</span>,         <span class="co"># patient 4</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>                <span class="st">"bleeding from gums, fever"</span>,   <span class="co"># patient 5</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">"rapid pulse, headache"</span>),      <span class="co"># patient 6</span></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="fu">c</span>(<span class="st">"Recover"</span>, <span class="st">"Death"</span>, <span class="st">"Death"</span>, <span class="st">"Recover"</span>, <span class="st">"Recover"</span>, <span class="st">"Recover"</span>))</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-327ca1bf833947f591da" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-327ca1bf833947f591da">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6"],[1,2,3,4,5,6],["jaundice, fever, chills","chills, aches, pains","fever","vomiting, diarrhoea","bleeding from gums, fever","rapid pulse, headache"],["Recover","Death","Death","Recover","Recover","Recover"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>case_ID<\/th>\n      <th>symptoms<\/th>\n      <th>outcome<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":1},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>We can split the <code>symptoms</code> column using <code>separate</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>df_split <span class="ot">&lt;-</span> <span class="fu">separate</span>(df, symptoms, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"sym_1"</span>, <span class="st">"sym_2"</span>, <span class="st">"sym_3"</span>), <span class="at">extra =</span> <span class="st">"merge"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 3 pieces. Missing pieces filled with `NA` in 2 rows [3, 4].</code></pre>
</div>
</div>
<p>Or, if we wanted to combine columns together, we can use <code>unite</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>df_split <span class="sc">%&gt;%</span> </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"all_symptoms"</span>,         <span class="co"># name of the new united column</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"sym_1"</span>, <span class="st">"sym_2"</span>, <span class="st">"sym_3"</span>), <span class="co"># columns to unite</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">", "</span>,                   <span class="co"># separator to use in united column</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">remove =</span> <span class="cn">TRUE</span>,                <span class="co"># if TRUE, removes input cols from the data frame</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.rm =</span> <span class="cn">TRUE</span>                  <span class="co"># if TRUE, missing values are removed before uniting</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  case_ID                all_symptoms outcome
1       1     jaundice, fever, chills Recover
2       2        chills, aches, pains   Death
3       3                       fever   Death
4       4         vomiting, diarrhoea Recover
5       5 bleeding, from, gums, fever Recover
6       6      rapid, pulse, headache Recover</code></pre>
</div>
</div>
</section>
<section id="standardizing-strings" class="level2">
<h2 data-anchor-id="standardizing-strings">Standardizing Strings</h2>
<p>There are a lot of useful functions for manipulating strings we won’t have time to demonstrate. You can find information on the use of these at <a href="https://epirhandbook.com/en/characters-and-strings.html#clean-and-standardise">this link</a>.</p>
</section>
<section id="patterns" class="level2">
<h2 data-anchor-id="patterns">Patterns</h2>
<p>To find the presence of a pattern, we can use <code>str_detect</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(<span class="at">string =</span> <span class="st">"primary school teacher"</span>, <span class="at">pattern =</span> <span class="st">"teach"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(<span class="at">string =</span> <span class="st">"Teacher"</span>, <span class="at">pattern =</span> <span class="fu">regex</span>(<span class="st">"teach"</span>, <span class="at">ignore_case =</span> T))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
</section>
<section id="column-cleaning" class="level1">
<h1>Column cleaning</h1>
<section id="data-1" class="level2">
<h2 data-anchor-id="data-1">Data</h2>
<p>Let’s load in a simulated ebola outbread dataset to take a look at some other cleaning operations in R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>linelist_raw <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"../data/linelist_raw.xlsx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `` -&gt; `...28`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(<span class="fu">head</span>(linelist_raw, <span class="dv">50</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-28c6197a5aee4623a6b0" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-28c6197a5aee4623a6b0">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50"],["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08T00:00:00Z",null,null,"2014-05-04T00:00:00Z","2014-05-18T00:00:00Z","2014-05-03T00:00:00Z","2014-05-22T00:00:00Z","2014-05-28T00:00:00Z",null,null,"2014-05-30T00:00:00Z","2014-05-28T00:00:00Z","2014-06-14T00:00:00Z","2014-06-07T00:00:00Z","2014-06-09T00:00:00Z",null,null,null,"2014-06-23T00:00:00Z","2014-06-18T00:00:00Z","2014-06-24T00:00:00Z",null,null,"2014-07-03T00:00:00Z",null,"2014-07-10T00:00:00Z","2014-06-14T00:00:00Z",null,"2014-06-18T00:00:00Z","2014-06-29T00:00:00Z","2014-07-02T00:00:00Z","2014-07-12T00:00:00Z","2014-07-12T00:00:00Z","2014-06-13T00:00:00Z","2014-07-15T00:00:00Z","2014-06-20T00:00:00Z",null,null,"2014-07-20T00:00:00Z",null,"2014-07-12T00:00:00Z","2014-07-19T00:00:00Z","2014-07-18T00:00:00Z","2014-07-18T00:00:00Z","2014-07-27T00:00:00Z",null,"2014-07-19T00:00:00Z","2014-07-26T00:00:00Z","2014-07-24T00:00:00Z",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15T00:00:00Z","2014-05-14T00:00:00Z","2014-05-18T00:00:00Z","2014-05-20T00:00:00Z","2014-05-22T00:00:00Z","2014-05-23T00:00:00Z","2014-05-29T00:00:00Z","2014-06-03T00:00:00Z","2014-06-06T00:00:00Z","2014-06-07T00:00:00Z","2014-06-08T00:00:00Z","2014-06-15T00:00:00Z","2014-06-17T00:00:00Z","2014-06-17T00:00:00Z","2014-06-20T00:00:00Z","2014-06-19T00:00:00Z","2014-06-23T00:00:00Z","2014-06-24T00:00:00Z","2014-06-27T00:00:00Z","2014-06-28T00:00:00Z","2014-06-29T00:00:00Z","2014-07-03T00:00:00Z","2014-07-09T00:00:00Z","2014-07-09T00:00:00Z","2014-07-11T00:00:00Z","2014-07-11T00:00:00Z","2014-07-13T00:00:00Z","2014-07-14T00:00:00Z","2014-07-14T00:00:00Z","2014-07-13T00:00:00Z","2014-07-14T00:00:00Z","2014-07-17T00:00:00Z","2014-07-17T00:00:00Z","2014-07-18T00:00:00Z","2014-07-19T00:00:00Z","2014-07-20T00:00:00Z","2014-07-20T00:00:00Z","2014-07-22T00:00:00Z","2014-07-24T00:00:00Z","2014-07-26T00:00:00Z","2014-07-24T00:00:00Z","2014-07-27T00:00:00Z","2014-07-25T00:00:00Z","2014-07-27T00:00:00Z","2014-07-31T00:00:00Z","2014-08-01T00:00:00Z","2014-08-03T00:00:00Z","2014-08-02T00:00:00Z","2014-08-02T00:00:00Z","2014-08-04T00:00:00Z"],[null,"2014-05-18T00:00:00Z","2014-05-30T00:00:00Z",null,"2014-05-29T00:00:00Z","2014-05-24T00:00:00Z","2014-06-01T00:00:00Z","2014-06-07T00:00:00Z","2014-06-18T00:00:00Z","2014-06-09T00:00:00Z","2014-06-15T00:00:00Z",null,"2014-07-09T00:00:00Z",null,"2014-06-30T00:00:00Z","2014-07-11T00:00:00Z","2014-07-01T00:00:00Z","2014-06-25T00:00:00Z","2014-07-06T00:00:00Z","2014-07-02T00:00:00Z","2014-07-09T00:00:00Z","2014-07-07T00:00:00Z","2014-07-20T00:00:00Z",null,"2014-07-22T00:00:00Z","2014-07-16T00:00:00Z","2014-07-14T00:00:00Z","2014-07-20T00:00:00Z","2014-07-16T00:00:00Z","2014-07-19T00:00:00Z","2014-07-27T00:00:00Z","2014-07-19T00:00:00Z",null,"2014-07-26T00:00:00Z","2014-08-14T00:00:00Z","2014-08-01T00:00:00Z","2014-07-23T00:00:00Z","2014-08-28T00:00:00Z","2014-07-28T00:00:00Z","2014-07-19T00:00:00Z",null,"2014-08-03T00:00:00Z",null,null,null,"2014-08-06T00:00:00Z","2014-08-21T00:00:00Z","2014-09-13T00:00:00Z","2014-08-04T00:00:00Z",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],["Other",null,"St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital",null,null,null,null,"Port Hospital","Military Hospital",null,null,"Other","Port Hospital","Port Hospital","Port Hospital",null,"Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)",null,"Other",null,"St. Marks Maternity Hopital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital",null,"Military Hospital","Other",null,null,"Port Hospital","Port Hospital","Port Hospital",null,"Central Hospital","Military Hospital","Other","Other","Other",null,"St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)",null],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.461830626007281,8.462729314626459,8.461443675342711,8.46191259217774,8.472923276435059,8.48401630165138,8.458371253408441,8.477617055125091,8.47570184950483,8.477799468789719,8.47145134147474,8.478048406853629,8.48528034195779,8.469575303958671,8.45957352078114,8.474048895115439,8.488029171298839,8.473437335922,8.484082637344621,8.46242233645879,8.470268221265719,8.463984474805329,8.464134789434199,8.456230946296071,8.48334624336805,8.47493999153642,8.47832062438022,8.469393389176499,8.48480589906514,8.47121232619015,8.48438437371817,8.484661585743391,8.477141599844281,8.462381270106089,8.455685978131131,8.4632880274758,8.47940722413856,8.46353857052336,8.461789681588639,8.47508713872833,8.458258081280711,8.4532568143863,8.4732571907655,8.479115866419329,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],["2","3","56","18","3","16","16","0","61","27","12","42","19","7","7","13","35","17","11","11","19","54","14","28","6","3","31","6","67","14","10","21","20","45","1","12","3","15","20","36","7","13","14","3","10","1","0","20","26","14"],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],["a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a"],["b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>infection date<\/th>\n      <th>date onset<\/th>\n      <th>hosp date<\/th>\n      <th>date_of_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>row_num<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>merged_header<\/th>\n      <th>...28<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,10,11,16,17,18,19,25]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>We can also quickly summarize our data using the <code>skimr</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>skimr<span class="sc">::</span><span class="fu">skim</span>(linelist_raw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">linelist_raw</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">6611</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">28</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">character</td>
<td style="text-align: left;">17</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">8</td>
</tr>
<tr class="even">
<td style="text-align: left;">POSIXct</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 20%">
<col style="width: 13%">
<col style="width: 19%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">empty</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: right;">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">case_id</td>
<td style="text-align: right;">137</td>
<td style="text-align: right;">0.98</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5888</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">date onset</td>
<td style="text-align: right;">293</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">580</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">outcome</td>
<td style="text-align: right;">1500</td>
<td style="text-align: right;">0.77</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">gender</td>
<td style="text-align: right;">324</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hospital</td>
<td style="text-align: right;">1512</td>
<td style="text-align: right;">0.77</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">infector</td>
<td style="text-align: right;">2323</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2697</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">source</td>
<td style="text-align: right;">2323</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">age</td>
<td style="text-align: right;">107</td>
<td style="text-align: right;">0.98</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">75</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age_unit</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">fever</td>
<td style="text-align: right;">258</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">chills</td>
<td style="text-align: right;">258</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">cough</td>
<td style="text-align: right;">258</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">aches</td>
<td style="text-align: right;">258</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">vomit</td>
<td style="text-align: right;">258</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">time_admission</td>
<td style="text-align: right;">844</td>
<td style="text-align: right;">0.87</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1091</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">merged_header</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">…28</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 14%">
<col style="width: 10%">
<col style="width: 14%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">generation</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">16.60</td>
<td style="text-align: right;">5.71</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">13.00</td>
<td style="text-align: right;">16.00</td>
<td style="text-align: right;">20.00</td>
<td style="text-align: right;">37.00</td>
<td style="text-align: left;">▁▆▇▂▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">lon</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">-13.23</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">-13.27</td>
<td style="text-align: right;">-13.25</td>
<td style="text-align: right;">-13.23</td>
<td style="text-align: right;">-13.22</td>
<td style="text-align: right;">-13.21</td>
<td style="text-align: left;">▅▃▃▅▇</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lat</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">8.47</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">8.45</td>
<td style="text-align: right;">8.46</td>
<td style="text-align: right;">8.47</td>
<td style="text-align: right;">8.48</td>
<td style="text-align: right;">8.49</td>
<td style="text-align: left;">▅▇▇▇▆</td>
</tr>
<tr class="even">
<td style="text-align: left;">row_num</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">3240.91</td>
<td style="text-align: right;">1857.83</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1647.50</td>
<td style="text-align: right;">3241.00</td>
<td style="text-align: right;">4836.50</td>
<td style="text-align: right;">6481.00</td>
<td style="text-align: left;">▇▇▇▇▇</td>
</tr>
<tr class="odd">
<td style="text-align: left;">wt_kg</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">52.69</td>
<td style="text-align: right;">18.59</td>
<td style="text-align: right;">-11.00</td>
<td style="text-align: right;">41.00</td>
<td style="text-align: right;">54.00</td>
<td style="text-align: right;">66.00</td>
<td style="text-align: right;">111.00</td>
<td style="text-align: left;">▁▃▇▅▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">ht_cm</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">125.25</td>
<td style="text-align: right;">49.57</td>
<td style="text-align: right;">4.00</td>
<td style="text-align: right;">91.00</td>
<td style="text-align: right;">130.00</td>
<td style="text-align: right;">159.00</td>
<td style="text-align: right;">295.00</td>
<td style="text-align: left;">▂▅▇▂▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ct_blood</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">21.26</td>
<td style="text-align: right;">1.67</td>
<td style="text-align: right;">16.00</td>
<td style="text-align: right;">20.00</td>
<td style="text-align: right;">22.00</td>
<td style="text-align: right;">22.00</td>
<td style="text-align: right;">26.00</td>
<td style="text-align: left;">▁▃▇▃▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">temp</td>
<td style="text-align: right;">158</td>
<td style="text-align: right;">0.98</td>
<td style="text-align: right;">38.60</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: right;">35.20</td>
<td style="text-align: right;">38.30</td>
<td style="text-align: right;">38.80</td>
<td style="text-align: right;">39.20</td>
<td style="text-align: right;">40.80</td>
<td style="text-align: left;">▁▂▂▇▁</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: POSIXct</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 19%">
<col style="width: 12%">
<col style="width: 17%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: left;">min</th>
<th style="text-align: left;">max</th>
<th style="text-align: left;">median</th>
<th style="text-align: right;">n_unique</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">infection date</td>
<td style="text-align: right;">2322</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: left;">2012-04-09</td>
<td style="text-align: left;">2015-04-27</td>
<td style="text-align: left;">2014-10-04</td>
<td style="text-align: right;">538</td>
</tr>
<tr class="even">
<td style="text-align: left;">hosp date</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: left;">2012-04-20</td>
<td style="text-align: left;">2015-04-30</td>
<td style="text-align: left;">2014-10-15</td>
<td style="text-align: right;">570</td>
</tr>
<tr class="odd">
<td style="text-align: left;">date_of_outcome</td>
<td style="text-align: right;">1068</td>
<td style="text-align: right;">0.84</td>
<td style="text-align: left;">2012-05-14</td>
<td style="text-align: left;">2015-06-04</td>
<td style="text-align: left;">2014-10-26</td>
<td style="text-align: right;">575</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="cleaning-column-names" class="level2">
<h2 data-anchor-id="cleaning-column-names">Cleaning column names</h2>
<p>The columns names of <code>linelist_raw</code> are printed below using <code>names()</code> from <strong>base</strong> R. We can see that initially:</p>
<ul>
<li>Some names contain spaces (e.g.&nbsp;<code>infection date</code>)<br>
</li>
<li>Different naming patterns are used for dates (<code>date onset</code> vs.&nbsp;<code>infection date</code>)<br>
</li>
<li>There must have been a <em>merged header</em> across the two last columns in the .xlsx. We know this because the name of two merged columns (“merged_header”) was assigned by R to the first column, and the second column was assigned a placeholder name “…28” (as it was then empty and is the 28th column).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(linelist_raw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "case_id"         "generation"      "infection date"  "date onset"     
 [5] "hosp date"       "date_of_outcome" "outcome"         "gender"         
 [9] "hospital"        "lon"             "lat"             "infector"       
[13] "source"          "age"             "age_unit"        "row_num"        
[17] "wt_kg"           "ht_cm"           "ct_blood"        "fever"          
[21] "chills"          "cough"           "aches"           "vomit"          
[25] "temp"            "time_admission"  "merged_header"   "...28"          </code></pre>
</div>
</div>
<section id="automatic-cleaning" class="level3">
<h3 data-anchor-id="automatic-cleaning">Automatic cleaning</h3>
<p>The function <code>clean_names()</code> from the package <strong>janitor</strong> standardizes column names and makes them unique by doing the following:</p>
<ul>
<li>Converts all names to consist of only underscores, numbers, and letters<br>
</li>
<li>Accented characters are transliterated to ASCII (e.g.&nbsp;german o with umlaut becomes “o”, spanish “enye” becomes “n”)<br>
</li>
<li>Capitalization preference for the new column names can be specified using the <code>case =</code> argument (“snake” is default, alternatives include “sentence”, “title”, “small_camel”…)<br>
</li>
<li>You can specify specific name replacements by providing a vector to the <code>replace =</code> argument (e.g.&nbsp;<code>replace = c(onset = "date_of_onset")</code>)</li>
</ul>
<p>Below, the cleaning pipeline begins by using <code>clean_names()</code> on the raw linelist.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pipe the raw dataset through the function clean_names(), assign result as "linelist"  </span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist_raw <span class="sc">%&gt;%</span> </span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a><span class="co"># see the new column names</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(linelist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "case_id"         "generation"      "infection_date"  "date_onset"     
 [5] "hosp_date"       "date_of_outcome" "outcome"         "gender"         
 [9] "hospital"        "lon"             "lat"             "infector"       
[13] "source"          "age"             "age_unit"        "row_num"        
[17] "wt_kg"           "ht_cm"           "ct_blood"        "fever"          
[21] "chills"          "cough"           "aches"           "vomit"          
[25] "temp"            "time_admission"  "merged_header"   "x28"            </code></pre>
</div>
</div>
</section>
<section id="manual-cleaning" class="level3">
<h3 data-anchor-id="manual-cleaning">Manual Cleaning</h3>
<p>Re-naming columns manually is often necessary, even after the standardization step above. Below, re-naming is performed using the <code>rename()</code> function from the <strong>dplyr</strong> package, as part of a pipe chain. <code>rename()</code> uses the style <code>NEW = OLD</code> - the new column name is given before the old column name.</p>
<p>Below, a re-naming command is added to the cleaning pipeline. Spaces have been added strategically to align code for easier reading.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist_raw <span class="sc">%&gt;%</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># standardize column name syntax</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># manually re-name columns</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>           <span class="co"># NEW name             # OLD name</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">date_infection       =</span> infection_date,</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">date_hospitalisation =</span> hosp_date,</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">date_outcome         =</span> date_of_outcome)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now you can see that the columns names have been changed:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> [1] "case_id"              "generation"           "date_infection"      
 [4] "date_onset"           "date_hospitalisation" "date_outcome"        
 [7] "outcome"              "gender"               "hospital"            
[10] "lon"                  "lat"                  "infector"            
[13] "source"               "age"                  "age_unit"            
[16] "row_num"              "wt_kg"                "ht_cm"               
[19] "ct_blood"             "fever"                "chills"              
[22] "cough"                "aches"                "vomit"               
[25] "temp"                 "time_admission"       "merged_header"       
[28] "x28"                 </code></pre>
</div>
</div>
</section>
</section>
<section id="advanced-column-selection" class="level2">
<h2 data-anchor-id="advanced-column-selection">Advanced Column Selection</h2>
<p>We’ve seen how to select individual columns by name. Tidyverse has a number of helper functions which let us select columns in more complex ways:</p>
<p>Use <code>where()</code> to specify logical criteria for columns. If providing a function inside <code>where()</code>, do not include the function’s empty parentheses. The command below selects columns that are class Numeric.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns that are class Numeric</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">%&gt;%</span> </span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "generation" "lon"        "lat"        "row_num"    "wt_kg"     
[6] "ht_cm"      "ct_blood"   "temp"      </code></pre>
</div>
</div>
<p>Use <code>contains()</code> to select only columns in which the column name contains a specified character string. <code>ends_with()</code> and <code>starts_with()</code> provide more nuance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns containing certain characters</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"date"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "date_infection"       "date_onset"           "date_hospitalisation"
[4] "date_outcome"        </code></pre>
</div>
</div>
<p>The function <code>matches()</code> works similarly to <code>contains()</code> but can be provided a regular expression, such as multiple strings separated by OR bars within the parentheses:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># searched for multiple character matches</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">"onset|hosp|fev"</span>)) <span class="sc">%&gt;%</span>   <span class="co"># note the OR symbol "|"</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "date_onset"           "date_hospitalisation" "hospital"            
[4] "fever"               </code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Handle positioning of the toggle
      window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          trigger: 'click',
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          positionFixed: true,
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>